SELECT  TBCLIENTA.CODCLI,
       CLIENTE,
       TBCLIENTA.FANTASIA,
       TIPOFJ AS TIPO_PESSOA,
       BAIRRO,
       TELCOB,
       TELCELENT,
       EMAIL,
       OBS,
       OBS2,
       OBS3,
       OBS4,
       DTULTCOMP,
        TBCLIENTA.CODVENDEDOR1,
        TBCLIENTA.LIMCRED,
        TBCLIENTA.CODVENDEDOR2,
       TBCLIENTA.DTCADASTRO,
        TBNFSAIDA.*,
       TBCLIENTA.BLOQUEIO,
       TBCLIENTA.BLOQUEIODEFINITIVO,
       TBCLIENTA.BLOQUEIOINATIVIDADE --        TBCLIENTA.*

FROM
  (SELECT  TBCLIENT.CODCLI,
          CLIENTE,
          TBCLIENT.FANTASIA,
          TBCLIENT.TIPOFJ,
          BAIRROCOB AS BAIRRO,
          TELCOB,
          TELCELENT,
          EMAIL,
          NVL(OBS, '0') AS OBS,
          OBS2,
          OBS3,
          OBS4,
          NVL(DTULTCOMP, DTCADASTRO) AS DTULTCOMP,
           TBCLIENT.CODVENDEDOR1,
           TBCLIENT.LIMCRED,
           TBCLIENT.CODVENDEDOR2,
          TBCLIENT.DTCADASTRO,
          TBCLIENT.BLOQUEIO,
          TBCLIENT.BLOQUEIODEFINITIVO,
          TBCLIENT.BLOQUEIOINATIVIDADE
   FROM TBCLIENT) TBCLIENTA,

  (SELECT  TBNFSAID.CODCLI,
          ROUND(AVG ( TBNFSAID.VLTOTAL),2) AS VLMEDIO_NOTA
   FROM  TBNFSAID
   WHERE CODFILIAL IN ('66',
                       '3',
                       '12',
                       '53')
   GROUP BY CODCLI)  TBNFSAIDA
WHERE  TBCLIENTA.CODCLI =  TBNFSAIDA.CODCLI (+)
  AND --CODVENDEDOR1 IN (500) AND -- ADRIANA
--CODVENDEDOR1 IN (502) AND -- ALINE
--CODVENDEDOR1 IN (510) AND -- BIANCA
--CODVENDEDOR1 IN (501) AND -- CELIA
CODVENDEDOR1 IN (503)
  AND -- SCARLETT
--CODVENDEDOR1 IN (523) AND -- VIVIAN
--BLOQUEIO NOT IN 'S'
 OBS NOT IN ('BLOQ. AUTOMATICO DEFINITIVO',
             'BLOQ. MANUAL DEFINITIVO',
             'BLOQ. MANUAL') --OBS IS NULL AND
-- AND DTULTCOMP BETWEEN '01-ABR-2018' AND '09-JUN-2018'
--  DTULTCOMP BETWEEN '01-JAN-2011' AND '09-JUN-2018'


ORDER BY DTULTCOMP
--ORDER BY PCCLIENTA.DTCADASTRO DESC




